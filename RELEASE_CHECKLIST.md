# AI 日语输入法 - 发布任务清单

## 📦 一、打包与分发

### 1.1 模型文件分发方案
- [x] **方案 A：首次启动时自动下载（推荐）**
  - [x] 创建 `model_downloader.py` 模块
  - [x] 程序首次启动检测模型是否存在 (`setup_wizard.py`)
  - [x] 不存在则弹出下载界面，显示进度条

### 1.2 打包方式
- [x] 创建 `build_exe.py` 打包脚本

---

## 🎨 二、用户体验改进

### 2.1 设置界面改造
- [x] 独立设置窗口 (`settings_window.py`)
- [x] 实时预览与即时生效
- [x] 智能模型管理
- [x] 主题随动

### 2.2 首次启动引导
- [x] 欢迎页
- [x] 核心模型强制检查与下载 (`setup_wizard.py`)

---

## 🐛 三、Bug 修复清单

### 3.1 必须修复
- [x] **config.json 完整性**: 确保所有配置项都有默认值和持久化
- [x] **模型不存在时的错误处理**: 通过 Wizard 强制下载
- [x] **网络断开时的 fallback**: 框架已支持异常捕获

### 3.2 建议修复
- [x] **托盘菜单精简**
- [x] **快捷键冲突处理**
- [x] **单实例运行限制**

---

## 📝 四、文档准备

### 4.1 用户文档
- [x] README.md

---

## 🚀 七、发布流程

1. **[x] 完成所有开发任务**
2. **[ ] 运行打包脚本 `python build_exe.py`**
3. **[ ] 进行最终用户测试**

## 📦 一、打包与分发

### 1.1 模型文件分发方案

目前模型文件约 2GB，有以下几种方案：

#### 方案 A：首次启动时自动下载（推荐）
- 创建 `model_downloader.py` 模块
- 程序首次启动检测模型是否存在
- 不存在则弹出下载界面，显示进度条
- 模型托管位置：
  - GitHub Releases (有单文件100MB限制，需分割)
  - HuggingFace Hub (推荐，无限制)
  - 阿里云 OSS / 腾讯 COS (国内速度快)

#### 方案 B：分离安装包
- 主程序安装包（约 50MB）
- 模型包（单独zip，约 2GB）
- 用户手动下载模型包，解压到 models 目录

#### 方案 C：内置模型（不推荐）
- 安装包体积过大（>2GB）
- 下载速度慢

### 1.2 打包方式

#### 使用 PyInstaller 打包为 EXE
```powershell
pip install pyinstaller
pyinstaller --onefile --windowed --icon=logo.ico main.py
```

#### 使用 Nuitka（性能更好）
```powershell
pip install nuitka
nuitka --standalone --windows-disable-console main.py
```

#### 使用 NSIS 制作安装程序
- 创建 Windows 安装向导
- 支持开始菜单快捷方式
- 支持自启动设置

---

## 🎨 二、用户体验改进

### 2.1 设置界面改造（参考"闪电说"）

当前：右键菜单形式
建议：独立设置窗口

```
┌─────────────────────────────────────┐
│          设置                    × │
├─────────────────────────────────────┤
│ ▼ 语音识别                          │
│   ├ ASR 引擎: [SenseVoice ONNX ▼]  │
│   └ 输出模式: [原始结果 ▼]          │
│                                     │
│ ▼ 翻译引擎                          │
│   └ 引擎选择: [NLLB 600M ▼]        │
│                                     │
│ ▼ 语音合成                          │
│   ├ 自动播放: [✓]                   │
│   └ 播放延迟: [5秒 ▼] (蓝牙耳机)    │
│                                     │
│ ▼ 界面设置                          │
│   ├ 主题: [深色 ▼]                  │
│   ├ 缩放: [100% ▼]                  │
│   └ 字体: [思源宋体 ▼]              │
│                                     │
│ ▼ 快捷键                            │
│   ├ 语音输入: Ctrl+Win             │
│   └ 显示/隐藏: Alt+Win              │
│                                     │
│ ▼ 模型管理                          │
│   ├ ASR模型: ✓ 已安装 (156MB)       │
│   ├ 翻译模型: ✓ 已安装 (578MB)      │
│   └ [下载/更新模型]                  │
│                                     │
│               [保存] [取消]          │
└─────────────────────────────────────┘
```

### 2.2 首次启动引导

```
┌─────────────────────────────────────┐
│     欢迎使用 AI 日语输入法          │
├─────────────────────────────────────┤
│                                     │
│  🎯 安装步骤                        │
│                                     │
│  [✓] 1. 程序已安装                  │
│  [○] 2. 下载语音识别模型 (156MB)    │
│         [开始下载]                   │
│  [ ] 3. 下载翻译模型 (578MB)        │
│  [ ] 4. 完成设置                    │
│                                     │
│  ─────────────────────────────────  │
│  总进度: 25%                        │
│  ████████░░░░░░░░░░░░░░░░░░░░░░░░  │
│                                     │
└─────────────────────────────────────┘
```

---

## 🐛 三、Bug 修复清单

### 3.1 必须修复

- [ ] **config.json 完整性**: 确保所有配置项都有默认值和持久化
- [ ] **模型不存在时的错误处理**: 友好提示而非崩溃
- [ ] **网络断开时的 fallback**: Google 翻译、Edge-TTS 失败时的处理
- [ ] **TTS 中断时的资源释放**: 确保 sounddevice 正确停止

### 3.2 建议修复

- [ ] **窗口位置记忆**: 保存上次窗口位置
- [ ] **日志轮转**: 限制 asr_process.log 大小
- [ ] **多显示器支持**: 确保窗口在正确的屏幕上显示

---

## 📝 四、文档准备

### 4.1 用户文档

- [ ] README.md - 项目介绍、功能说明、截图
- [ ] 安装指南.md - 详细安装步骤
- [ ] 使用教程.md - 快速上手指南
- [ ] FAQ.md - 常见问题解答

### 4.2 开发文档

- [ ] 项目结构说明
- [ ] 模块接口文档
- [ ] 贡献指南

---

## 🔐 五、安全与隐私

- [ ] 确认无敏感信息硬编码
- [ ] 添加隐私政策说明（说明数据本地处理）
- [ ] 考虑添加开源许可证

---

## 📊 六、测试清单

### 6.1 功能测试

- [ ] ASR 语音识别（中文）
- [ ] 翻译功能（中→日）
- [ ] TTS 语音播放
- [ ] 快捷键注册/响应
- [ ] 模式切换（ASR/翻译/日语ASR）
- [ ] 设置持久化
- [ ] 窗口拖动/显示/隐藏
- [ ] 托盘图标交互

### 6.2 边界测试

- [ ] 无模型文件时启动
- [ ] 无网络时使用在线功能
- [ ] 长文本翻译
- [ ] 特殊字符/表情符号
- [ ] 快速连续输入

### 6.3 兼容性测试

- [ ] Windows 10 21H2+
- [ ] Windows 11
- [ ] 高 DPI 显示器
- [ ] 多显示器
- [ ] 蓝牙/有线耳机

---

## 🚀 七、发布流程

1. **完成所有必须修复项**
2. **运行完整测试清单**
3. **更新版本号**
4. **生成安装包**
5. **上传模型文件到托管平台**
6. **发布到 GitHub Releases**
7. **编写发布说明**
