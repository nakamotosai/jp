# AI 日语输入法 - 产品化实施方案

## 📋 一、功能需求清单

### 1.1 设置界面
- [x] 独立设置窗口（可滚动）
- [x] 顶部"检查更新"按钮
- [x] 所有设置项集中管理
- [x] 开机自启动选项
- [x] 启动时显示/隐藏主界面选项

### 1.2 模型管理
- [x] ASR模型：首次启动强制下载
- [x] 翻译模型：可选下载（默认使用Google在线翻译）
- [x] 下载进度显示
- [x] 设置中提供下载入口

### 1.3 安装程序
- [x] NSIS 制作
- [x] 开机自启动选项
- [x] 开始菜单快捷方式
- [x] 桌面快捷方式（可选）
- [x] 卸载程序

---

## 🌐 二、模型托管方案（中国用户友好）

### 推荐方案：多源下载

由于单一托管平台可能存在访问问题，建议实现**多源下载**机制：

| 优先级 | 托管平台 | 优点 | 缺点 | 适用场景 |
|--------|----------|------|------|----------|
| 1 | **HuggingFace 镜像站** | 免费、快速、无限流量 | 需使用镜像域名 | 首选 |
| 2 | **GitHub Releases** | 免费、稳定 | 国内访问不稳定 | 备用 |
| 3 | **阿里云 OSS** | 国内最快 | 需付费（约 ¥0.12/GB） | 商业化后使用 |

### 实现方案

```python
DOWNLOAD_SOURCES = {
    "asr_model": {
        "name": "SenseVoice 语音识别模型",
        "size_mb": 156,
        "mirrors": [
            # HuggingFace 镜像站（中国可访问）
            "https://hf-mirror.com/FunAudioLLM/SenseVoiceSmall/resolve/main/model.onnx",
            # 官方 HuggingFace（备用）
            "https://huggingface.co/FunAudioLLM/SenseVoiceSmall/resolve/main/model.onnx",
            # GitHub Releases（备用）
            "https://github.com/yourname/ai-jp-input/releases/download/models/sensevoice.zip",
        ]
    },
    "nllb_model": {
        "name": "NLLB 翻译模型 (可选)",
        "size_mb": 578,
        "mirrors": [
            "https://hf-mirror.com/YOUR_ACCOUNT/nllb-600m-ct2/resolve/main/model.zip",
            "https://huggingface.co/YOUR_ACCOUNT/nllb-600m-ct2/resolve/main/model.zip",
        ]
    }
}
```

### HuggingFace 镜像站使用说明

中国用户可以通过以下镜像站访问 HuggingFace：
- **https://hf-mirror.com** - 主镜像站
- **https://huggingface.sukaka.top** - 备用镜像

只需将 `huggingface.co` 替换为镜像域名即可。

---

## 🎨 三、设置界面设计

### 界面布局

```
┌──────────────────────────────────────────────────────┐
│ ⚙️ AI 日语输入法 设置                            ✕ │
├──────────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────────┐  │
│ │  🔄 检查更新    当前版本: v1.0.0              │  │
│ └────────────────────────────────────────────────┘  │
│                                                      │
│ ═══════════════ 🎤 语音识别 ═══════════════════════ │
│                                                      │
│  引擎选择                                            │
│  ┌─────────────────────────────────────────────┐    │
│  │ ● SenseVoice ONNX (推荐)                    │◀── │
│  │ ○ SenseVoice PyTorch                        │    │
│  └─────────────────────────────────────────────┘    │
│                                                      │
│  输出模式                                            │
│  ○ 原始结果    ● 智能清理                           │
│                                                      │
│  模型状态: ✅ 已安装 (156 MB)                        │
│                                                      │
│ ═══════════════ 🌏 翻译引擎 ═══════════════════════ │
│                                                      │
│  引擎选择                                            │
│  ┌─────────────────────────────────────────────┐    │
│  │ ● Google 在线翻译 (无需下载)                │◀── │
│  │ ○ NLLB 600M 本地模型 (需下载 578MB)         │    │
│  │ ○ NLLB 1.2B 本地模型 (需下载 1.2GB)         │    │
│  └─────────────────────────────────────────────┘    │
│                                                      │
│  本地模型状态: ⚠️ 未安装                             │
│  [下载 NLLB 本地模型]                                │
│  💡 使用本地模型可离线翻译，且响应更快              │
│                                                      │
│ ═══════════════ 🔊 语音合成 ═══════════════════════ │
│                                                      │
│  [✓] 翻译后自动朗读日语                             │
│                                                      │
│  朗读延迟 (蓝牙耳机用户请设置)                       │
│  [0秒] [1秒] [3秒] [●5秒] [7秒]                      │
│  └ 蓝牙耳机录音后需等待模式切换                      │
│                                                      │
│ ═══════════════ 🎨 外观设置 ═══════════════════════ │
│                                                      │
│  主题    ● 深色    ○ 浅色                           │
│  缩放    [80%] [●100%] [120%] [150%]                │
│  字体    ● 思源宋体  ○ 思源黑体                     │
│  字号    [80%] [●100%] [120%] [150%]                │
│                                                      │
│ ═══════════════ ⌨️ 快捷键 ══════════════════════════ │
│                                                      │
│  语音输入 (按住说话)                                 │
│  ┌────────────────────────────────┐ [修改]          │
│  │ Ctrl + Win                     │                 │
│  └────────────────────────────────┘                 │
│                                                      │
│  显示/隐藏窗口                                       │
│  ┌────────────────────────────────┐ [修改]          │
│  │ Alt + Win                      │                 │
│  └────────────────────────────────┘                 │
│                                                      │
│ ═══════════════ 🚀 启动设置 ═══════════════════════ │
│                                                      │
│  [✓] 开机自动启动                                   │
│  [ ] 启动时显示主窗口 (取消则最小化到托盘)          │
│                                                      │
│ ═══════════════ 🤖 AI 个性 ════════════════════════ │
│                                                      │
│  ┌─────────────────────────────────────────────┐    │
│  │ ○ 默认风格                                  │    │
│  │ ● 赛博朋克                                  │◀── │
│  │ ○ 可爱猫娘                                  │    │
│  └─────────────────────────────────────────────┘    │
│                                                      │
│ ═══════════════ ℹ️ 关于 ═══════════════════════════ │
│                                                      │
│  AI 日语输入法 v1.0.0                               │
│  © 2024 Your Name                                   │
│  [GitHub] [反馈问题] [使用帮助]                      │
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 📦 四、NSIS 安装程序

### 安装流程

```
1. 欢迎页面
   └─ "欢迎安装 AI 日语输入法"

2. 许可协议
   └─ MIT License

3. 安装选项
   ├─ [✓] 创建桌面快捷方式
   ├─ [✓] 创建开始菜单项
   └─ [ ] 开机自动启动

4. 安装路径
   └─ C:\Program Files\AI日语输入法\

5. 安装进度
   └─ 正在安装...

6. 完成页面
   ├─ [✓] 立即运行程序
   └─ [ ] 查看 README
```

### 开机自启动实现

```nsis
; 注册表方式实现开机自启动
WriteRegStr HKCU "Software\Microsoft\Windows\CurrentVersion\Run" \
    "AIJapaneseInput" "$INSTDIR\AIJapaneseInput.exe --minimized"
```

---

## 🚀 五、首次启动引导流程

### 流程设计

```
┌─────────────────────────────────────────────────────────┐
│           欢迎使用 AI 日语输入法                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│    🎉 感谢您选择 AI 日语输入法！                        │
│                                                         │
│    在开始使用之前，需要下载一些必要的模型文件。         │
│                                                         │
│    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                         │
│    📦 语音识别模型 (必需)                    156 MB     │
│    ┌─────────────────────────────────────────────────┐  │
│    │ ████████████████████████████░░░░░░░░  75%       │  │
│    └─────────────────────────────────────────────────┘  │
│    正在下载: model.onnx (117/156 MB)                    │
│                                                         │
│    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                         │
│    📦 翻译模型 (可选)                        578 MB     │
│    └─ 暂时跳过，使用 Google 在线翻译                    │
│       (可稍后在设置中下载以启用离线翻译)                │
│                                                         │
│    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                         │
│                                [跳过翻译模型，开始使用]  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 📁 六、项目结构（产品化后）

```
AI日语输入法/
├── src/                        # 源代码
│   ├── main.py                 # 主入口
│   ├── ui/                     # UI 组件
│   │   ├── main_window.py      # 主窗口（输入界面）
│   │   ├── settings_window.py  # 设置窗口 [新增]
│   │   ├── setup_wizard.py     # 首次启动引导 [新增]
│   │   └── download_dialog.py  # 下载进度对话框 [新增]
│   ├── core/                   # 核心功能
│   │   ├── asr_manager.py
│   │   ├── translator_engine.py
│   │   └── tts_worker.py
│   ├── utils/                  # 工具模块
│   │   ├── model_downloader.py # 模型下载器 [新增]
│   │   ├── auto_updater.py     # 自动更新 [新增]
│   │   └── startup_manager.py  # 开机启动管理 [新增]
│   └── config/
│       ├── model_config.py
│       └── settings.py
├── installer/                  # 安装程序 [新增]
│   ├── nsis/
│   │   └── installer.nsi       # NSIS 脚本
│   └── assets/
│       ├── icon.ico
│       └── banner.bmp
├── models/                     # 模型文件（不打包）
├── fonts/
├── requirements.txt
└── README.md
```

---

## ⏱️ 七、开发工作量估算

| 任务 | 工作量 | 优先级 |
|------|--------|--------|
| 模型下载器（含镜像源切换） | 4-6 小时 | P0 |
| 首次启动引导界面 | 3-4 小时 | P0 |
| 设置窗口（完整版） | 6-8 小时 | P1 |
| 开机自启动功能 | 1-2 小时 | P1 |
| NSIS 安装脚本 | 2-3 小时 | P1 |
| 自动更新检查 | 2-3 小时 | P2 |
| PyInstaller 打包调试 | 2-4 小时 | P1 |

**总计：20-30 小时（约 3-4 天全职开发）**

---

## 🎯 八、建议开发顺序

### 第一阶段：核心功能（必须）
1. ✅ 修复 requirements.txt
2. 模型下载器 + 镜像源
3. 首次启动引导（最小版）
4. PyInstaller 打包测试

### 第二阶段：用户体验（重要）
5. 设置窗口（完整版）
6. 开机自启动管理
7. 启动时显示/隐藏选项

### 第三阶段：分发（发布）
8. NSIS 安装脚本
9. 上传模型到 HuggingFace
10. README 和文档
11. GitHub Releases 发布

### 第四阶段：迭代（后续）
12. 自动更新检查
13. 翻译历史记录
14. 更多功能...
